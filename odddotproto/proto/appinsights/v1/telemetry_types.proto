syntax = "proto3";

package odddotnet.proto.appinsights.v1;

import "odddotproto/proto/appinsights/v1/common.proto";

option csharp_namespace = "OddDotNet.Proto.AppInsights.V1";
option java_multiple_files = true;
option java_package = "io.odddotnet.proto.appinsights.v1";
option java_outer_classname = "TelemetryTypesProto";
option go_package = "go.odddotnet.io/proto/appinsights/v1";

// Request telemetry - represents an HTTP request handled by the application
message RequestTelemetry {
  string id = 1;
  string name = 2;
  string duration = 3;  // TimeSpan format: "00:00:01.234"
  string response_code = 4;
  bool success = 5;
  string url = 6;
  string source = 7;
  map<string, string> properties = 8;
  map<string, double> measurements = 9;
}

// Dependency telemetry - represents an external call (HTTP, SQL, etc.)
message DependencyTelemetry {
  string id = 1;
  string name = 2;
  string duration = 3;
  string result_code = 4;
  bool success = 5;
  string data = 6;  // Command/URL text
  string target = 7;  // Target hostname
  string type = 8;  // HTTP, SQL, Azure Blob, etc.
  map<string, string> properties = 9;
  map<string, double> measurements = 10;
}

// Exception telemetry - represents an error or exception
message ExceptionTelemetry {
  string id = 1;
  string problem_id = 2;
  repeated ExceptionDetails exceptions = 3;
  SeverityLevel severity_level = 4;
  map<string, string> properties = 5;
  map<string, double> measurements = 6;
}

// Details about a single exception in the exception chain
message ExceptionDetails {
  int32 id = 1;
  int32 outer_id = 2;
  string type_name = 3;
  string message = 4;
  bool has_full_stack = 5;
  string stack = 6;  // Raw stack trace string
  repeated StackFrame parsed_stack = 7;
}

// A single stack frame
message StackFrame {
  int32 level = 1;
  string method = 2;
  string assembly = 3;
  string file_name = 4;
  int32 line = 5;
}

// Trace telemetry - represents a log message
message TraceTelemetry {
  string message = 1;
  SeverityLevel severity_level = 2;
  map<string, string> properties = 3;
}

// Event telemetry - represents a custom event
message EventTelemetry {
  string name = 1;
  map<string, string> properties = 2;
  map<string, double> measurements = 3;
}

// Metric telemetry - represents a metric data point
message MetricTelemetry {
  string name = 1;
  string metric_namespace = 2;
  double value = 3;
  int32 count = 4;
  optional double min = 5;
  optional double max = 6;
  optional double std_dev = 7;
  map<string, string> properties = 8;
}

// PageView telemetry - represents a web page view
message PageViewTelemetry {
  string id = 1;
  string name = 2;
  string url = 3;
  string duration = 4;
  string referrer_uri = 5;
  map<string, string> properties = 6;
  map<string, double> measurements = 7;
}

// Availability telemetry - represents an availability test result
message AvailabilityTelemetry {
  string id = 1;
  string name = 2;
  string duration = 3;
  bool success = 4;
  string run_location = 5;
  string message = 6;
  map<string, string> properties = 7;
  map<string, double> measurements = 8;
}

// SeverityLevel is defined in common.proto
