syntax = "proto3";

package odddotnet.proto.appinsights.v1;

import "odddotproto/proto/appinsights/v1/common.proto";
import "odddotproto/proto/common/v1/properties.proto";

option csharp_namespace = "OddDotNet.Proto.AppInsights.V1";
option java_multiple_files = true;
option java_package = "io.odddotnet.proto.appinsights.v1";
option java_outer_classname = "EnvelopeFiltersProto";
option go_package = "go.odddotnet.io/proto/appinsights/v1";

// ============================================================================
// Common envelope/context filters shared by all telemetry types
// ============================================================================

message EnvelopeFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty instrumentation_key = 1;
    odddotnet.proto.common.v1.StringProperty time = 2;
    ContextFilter context = 3;
  }
}

message ContextFilter {
  oneof value {
    OperationContextFilter operation = 1;
    CloudContextFilter cloud = 2;
    DeviceContextFilter device = 3;
    UserContextFilter user = 4;
    SessionContextFilter session = 5;
    LocationContextFilter location = 6;
    ApplicationContextFilter application = 7;
    InternalContextFilter internal = 8;
  }
}

message OperationContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty id = 1;
    odddotnet.proto.common.v1.StringProperty parent_id = 2;
    odddotnet.proto.common.v1.StringProperty name = 3;
    odddotnet.proto.common.v1.StringProperty synthetic_source = 4;
    odddotnet.proto.common.v1.StringProperty correlation_vector = 5;
  }
}

message CloudContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty role_name = 1;
    odddotnet.proto.common.v1.StringProperty role_instance = 2;
  }
}

message DeviceContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty id = 1;
    odddotnet.proto.common.v1.StringProperty type = 2;
    odddotnet.proto.common.v1.StringProperty os_version = 3;
  }
}

message UserContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty id = 1;
    odddotnet.proto.common.v1.StringProperty authenticated_id = 2;
    odddotnet.proto.common.v1.StringProperty account_id = 3;
  }
}

message SessionContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty id = 1;
    odddotnet.proto.common.v1.BoolProperty is_first = 2;
  }
}

message LocationContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty ip = 1;
    odddotnet.proto.common.v1.StringProperty country = 2;
    odddotnet.proto.common.v1.StringProperty province = 3;
    odddotnet.proto.common.v1.StringProperty city = 4;
  }
}

message ApplicationContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty version = 1;
  }
}

message InternalContextFilter {
  oneof value {
    odddotnet.proto.common.v1.StringProperty sdk_version = 1;
    odddotnet.proto.common.v1.StringProperty agent_version = 2;
    odddotnet.proto.common.v1.StringProperty node_name = 3;
  }
}

// Custom property/measurement filters
message PropertyMapFilter {
  string key = 1;
  odddotnet.proto.common.v1.StringProperty value = 2;
}

message MeasurementMapFilter {
  string key = 1;
  odddotnet.proto.common.v1.DoubleProperty value = 2;
}

// Severity level filter (used by Exception and Trace)
message SeverityLevelProperty {
  odddotnet.proto.common.v1.EnumCompareAsType compare_as = 1;
  SeverityLevel compare = 2;
}
